@{
    ViewBag.Title = "Home Page";
}

<div class="row" style="margin-top:50px">
    <div class="col-md-6">
        <table class="table">
            <tr>
                <th>ID</th>
                <th>Movie</th>
                <th>Votes</th>
                <th></th>
            </tr>
            @foreach (var movie in MvcApplication.Movies)
            {
                <tr>
                    <td>@movie.Id</td>
                    <td>@movie.Name</td>
                    <td class="voteCount" data-id="@movie.Id">@movie.VoteCount</td>
                    <td><button class="btn voteButton" data-id="@movie.Id">Vote</button></td>
                </tr>
            }
        </table>
    </div>
</div>

@section scripts
{

<!--Script references. -->
<!--Reference the SignalR library. -->
<script src="Scripts/jquery.signalR-2.1.2.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="signalr/hubs"></script>
<!--Add script to update the page and send messages.-->
<script type="text/javascript">
    $(function () {
        // Declare a proxy to reference the hub.
        var vote = $.connection.voteHub;
        // Create a function that the hub can call to broadcast messages.
        vote.client.broadcastMessage = function (id, newCount) {
            var td = $(".voteCount[data-id=" + id + "]").text(newCount);
        };

        $.connection.hub.start().done(function () {
            $('.voteButton').click(function () {
                console.log("Send vote to server");

                // Call the Send method on the hub.
                vote.server.vote($(this).data("id"));
            });
        });
    });
</script>
}